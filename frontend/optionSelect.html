<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>스타일 추천 시스템</title>
    <link rel="icon" type="image/x-icon" href="웹페이지아이콘추가" />
    <!-- Font Awesome icons (free version)-->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />

    <!--백엔드와 연동-->
    <script src="../backend/server.js"></script>

    <!-- 동적 네비게이션 로드 -->
    <script src="navbar.js" defer></script>

    <style>
      .option {
        display: none;
        text-align: center;
        padding-top: 70px;
        margin: auto;
      }
      div .phyInfo {
        text-align: right;
        width: 300px;
        height: 120px;
        margin: 0px auto;
        padding-bottom: 10px auto;
      }
      .images img {
        width: 250px;
        height: auto;
        margin: 5px;
        cursor: pointer;
      }
      /*상단바 관련*/
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        padding-top: 70px;
      }
      .preset {
        border: 1px solid #ddd;
        margin: 20px auto;
        padding: 10px;
        border-radius: 5px;

        /*가로 세로 200px만큼 줄이기*/
        width: 800px;
        height: auto;

        overflow: auto; /*내용이 넘칠경우 스크롤 생기도록 설정*/
      }
      .preset-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .item {
        display: flex;
        margin: 10px auto;
        width: 450px;
        height: 450px;
        /*height: auto;*/
      }
      .item img {
        width: 200px;
        height: 270px;
        margin-right: 10px;
      }
      .item-info {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .button {
        margin-top: 10px;
        margin-bottom: 30px;
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        border-radius: 5px;
      }
      .delete-button {
        background-color: #dc3545;
      }
      .settings-button {
        margin-left: 10px;
      }

      /*옵션 관련 스타일*/
      .option {
        display: none;
      }
      .images img {
        width: 100px;
        height: auto;
        margin: 5px;
        cursor: pointer;
      }

      /*상하의선택옵션 관련*/
      .hidden {
        display: none;
      }
      .item {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <div id="nav-container"></div>
    <!-- 동적으로 nav.html 삽입 -->

    <!--성별선택 옵션-->
    <div id="option1" class="option">
      <h2>성별을 선택하세요</h2>
      <div class="images">
        <img
          src="image/man.jpg"
          alt="남성이미지"
          onclick="selectOption('option1', '남성')"
        />
        <img
          src="image/woman.jpg"
          alt="여성이미지"
          onclick="selectOption('option1', '여성')"
        />
      </div>
    </div>
    <!--어느정도 구현완료-->

    <!--키 몸무게 입력옵션-->
    <div id="option2" class="option">
      <h2>자신의 신체정보를 입력해주세요</h2>
      <!--저장방식이 아니라 일단 클릭시 넘어가는 방식으로 임시구현-->
      <!--숫자만 입력되게, 입력이 안됐거나 숫자 이외의 것들을 입력시 다시입력되게 만들기-->
      <div class="phyInfo">
        <label for="number">키 : </label>
        <input
          type="text"
          placeholder="숫자 입력"
          id="option_stature"
          name="option_stature"
        />
        <p></p>
        <label for="number">몸무게 : </label>
        <input
          type="text"
          placeholder="숫자 입력"
          id="option_weight"
          name="option_weight"
        />
      </div>
      <!--
      <div class="phyInfo">
        <label for="number">몸무게 : </label>
        <input type="text" placeholder="숫자 입력" id="option_weight" name="option_weight" />
      </div>
    -->
      <button onclick="selectOptionInput('option2')">다음</button>
      <button onclick="clearInput()">다시 입력</button>
      <button onclick="goBack('option2','option1')">뒤로가기</button>
    </div>
    <!--어느정도 구현완료-->

    <!--상하의 둘중하나 선택-->
    <div id="option3" class="option">
      <h2>상하의 선택</h2>
      <div class="images">
        <img
          src="image/TopImage.jpg"
          alt="상의이미지"
          onclick="selectOption('option3', '상의')"
        />
        <img
          src="image/BottomImage.jpg"
          alt="하의이미지"
          onclick="selectOption('option3', '하의')"
        />
      </div>
      <button onclick="goBack('option3','option2')">뒤로가기</button>
    </div>

    <!--선택한 의류 추천-->
    <div id="option4" class="option">
      <!--상의 선택시-->
      <div>
        <h2>상의 스타일 선택</h2>

        <!-- 카테고리 선택 영역 -->
        <div id="category-selection">
          <h2>카테고리 선택</h2>
          <select id="category">
            <option value="">선택하세요</option>
            <option value="캐주얼">캐주얼</option>
            <option value="스트릿">스트릿</option>
            <option value="미니멀">미니멀</option>
            <option value="워크웨어">워크웨어</option>
          </select>
          <button onclick="showRecommendations()">추천받기</button>
          <button onclick="goBack('option4','option3')">뒤로가기</button>
        </div>

        <!-- 추천 상품 영역 -->
        <div id="recommendations" class="hidden">
          <h2>추천 상품</h2>
          <div id="items"></div>
          <button onclick="reRecommend()">재추천</button>
          <button onclick="goBackToCategory()">뒤로가기</button>
        </div>

        <!-- 관련 하의 추천 영역 -->
        <div id="related-recommendations" class="hidden">
          <h2>관련된 하의 추천</h2>
          <div id="related-items"></div>
          <button onclick="relatedReRecommend()">재추천</button>
          <button onclick="goBackToRecommendations()">뒤로가기</button>
        </div>
      </div>
    </div>

    <!--결정한 의류 보여주기-->
    <!--보러가기 눌렀을때 새창으로 띄어주면서 보여주기-->
    <!--저장 을 눌렀을때 로그인 되어있다면 바로저장, 비로그인시 로그인 후 저장되게끔-->
    <div id="option5" class="option">
      <h2>맞춤 스타일</h2>
      <div>
        <table>
          <tr>
            <td rowspan="6">
              <img
                src="image/TopImage.jpg"
                alt="..."
                width="250px"
                height="300px"
              />
            </td>
            <th>상의 상품정보</th>
          </tr>
          <tr>
            <td>상품명</td>
          </tr>
          <tr>
            <td>상품정보</td>
          </tr>
          <tr>
            <td>상품정보2</td>
          </tr>
          <tr>
            <td>
              <button>변경</button>
              <button>보러가기</button>
            </td>
          </tr>
        </table>
        <table>
          <tr>
            <td rowspan="5">
              <img
                src="image/BottomImage.jpg"
                alt="..."
                width="330px"
                height="430px"
              />
            </td>
            <th>하의 상품정보</th>
          </tr>
          <tr>
            <td>상품명</td>
          </tr>
          <tr>
            <td>상품정보</td>
          </tr>
          <tr>
            <td>상품정보2</td>
          </tr>
          <tr>
            <td>
              <button>변경</button>
              <button>보러가기</button>
            </td>
          </tr>
        </table>
        <button>재추천</button>
        <button onclick="location.href='myPreset.html'">내스타일에 저장</button>
      </div>
    </div>

    <script>
      //옵션선택페이지를 카운팅해주는 변수
      let currentOptionIndex = 0;

      // 페이지 로드 시 첫 번째 옵션 보여주기
      window.onload = function () {
        showNextOption();
      };

      //다음 옵션으로 넘어가게끔 만듦
      function showNextOption() {
        if (currentOptionIndex < 7) {
          document.getElementById(
            `option${currentOptionIndex + 1}`
          ).style.display = "block";
        }
      }

      //선다형 선택창
      function selectOption(optionId, selectedOption) {
        alert(selectedOption + "(을)를 선택하였습니다.");
        document.getElementById(optionId).style.display = "none"; // 선택한 옵션 숨기기
        currentOptionIndex++;
        showNextOption(); // 다음 옵션 보기
      }

      //키,몸무게 입력창
      function selectOptionInput(optionID) {
        var stature = document.getElementById("option_stature").value;
        var weight = document.getElementById("option_weight").value;

        //입력값이 숫자인지 확인
        if (
          !isNaN(stature) &&
          !isNaN(weight) &&
          stature !== "" &&
          weight !== ""
        ) {
          alert(
            "키 : " + stature + ", 몸무게 : " + weight + "가 입력되었습니다."
          );
          document.getElementById(optionID).style.display = "none";
          currentOptionIndex++;
          showNextOption();
        } else {
          alert("올바른 숫자를 입력해주세요.");
        }
      }

      //뒤로가기 버튼
      function goBack(currentoptionID, previousoptionID) {
        //현재옵션 숨기기
        document.getElementById(currentoptionID).style.display = "none";

        //이전 옵션 보이기
        if (previousoptionID) {
          document.getElementById(previousoptionID).style.display = "block";
        }
        currentOptionIndex--;
      }

      //상의
      // 각 카테고리에 대한 상의 상품 목록
      const products = {
        캐주얼: [
          { name: "캐주얼 상의 1", img: "image1.jpg" },
          { name: "캐주얼 상의 2", img: "image2.jpg" },
          { name: "캐주얼 상의 3", img: "image3.jpg" },
          { name: "캐주얼 상의 4", img: "image4.jpg" },
          { name: "캐주얼 상의 5", img: "image5.jpg" },
        ],
        스트릿: [
          { name: "스트릿 상의 1", img: "image1.jpg" },
          { name: "스트릿 상의 2", img: "image2.jpg" },
          { name: "스트릿 상의 3", img: "image3.jpg" },
          { name: "스트릿 상의 4", img: "image4.jpg" },
          { name: "스트릿 상의 5", img: "image5.jpg" },
        ],
        미니멀: [
          { name: "미니멀 상의 1", img: "image1.jpg" },
          { name: "미니멀 상의 2", img: "image2.jpg" },
          { name: "미니멀 상의 3", img: "image3.jpg" },
          { name: "미니멀 상의 4", img: "image4.jpg" },
          { name: "미니멀 상의 5", img: "image5.jpg" },
        ],
        워크웨어: [
          { name: "워크웨어 상의 1", img: "image1.jpg" },
          { name: "워크웨어 상의 2", img: "image2.jpg" },
          { name: "워크웨어 상의 3", img: "image3.jpg" },
          { name: "워크웨어 상의 4", img: "image4.jpg" },
          { name: "워크웨어 상의 5", img: "image5.jpg" },
        ],
      };

      // 각 카테고리에 대한 관련 하의 상품 목록
      const relatedProducts = {
        캐주얼: [
          { name: "캐주얼 하의 1", img: "related1.jpg" },
          { name: "캐주얼 하의 2", img: "related2.jpg" },
          { name: "캐주얼 하의 3", img: "related3.jpg" },
        ],
        스트릿: [
          { name: "스트릿 하의 1", img: "related1.jpg" },
          { name: "스트릿 하의 2", img: "related2.jpg" },
          { name: "스트릿 하의 3", img: "related3.jpg" },
        ],
        미니멀: [
          { name: "미니멀 하의 1", img: "related1.jpg" },
          { name: "미니멀 하의 2", img: "related2.jpg" },
          { name: "미니멀 하의 3", img: "related3.jpg" },
        ],
        워크웨어: [
          { name: "워크웨어 하의 1", img: "related1.jpg" },
          { name: "워크웨어 하의 2", img: "related2.jpg" },
          { name: "워크웨어 하의 3", img: "related3.jpg" },
        ],
      };

      // 추천 상품을 보여주는 함수
      function showRecommendations() {
        const category = document.getElementById("category").value;
        if (!category) return; // 카테고리가 선택되지 않으면 함수 종료

        // 선택한 카테고리에 따라 화면 전환
        document.getElementById("category-selection").classList.add("hidden");
        document.getElementById("recommendations").classList.remove("hidden");

        displayItems(products[category]); // 상품 목록 표시
      }

      // 상품 목록을 랜덤으로 표시하는 함수
      function displayItems(itemList) {
        const itemsDiv = document.getElementById("items");
        itemsDiv.innerHTML = ""; // 이전 내용 초기화

        // 랜덤으로 3개의 상품 선택
        const randomItems = itemList
          .sort(() => 0.5 - Math.random())
          .slice(0, 3);
        randomItems.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";
          itemDiv.innerHTML = `<img src="${item.img}" alt="${item.name}" width="100"><br>${item.name}`;
          itemDiv.onclick = () => showRelatedRecommendations(item.name); // 클릭 시 관련 하의 추천
          itemsDiv.appendChild(itemDiv);
        });
      }

      // 재추천 기능
      function reRecommend() {
        const category = document.getElementById("category").value;
        displayItems(products[category]); // 선택한 카테고리에서 상품 재추천
      }

      // 카테고리 선택 화면으로 돌아가는 함수
      function goBackToCategory() {
        document.getElementById("recommendations").classList.add("hidden");
        document
          .getElementById("category-selection")
          .classList.remove("hidden");
      }

      // 관련 하의 추천을 보여주는 함수
      function showRelatedRecommendations(selectedItem) {
        const category = document.getElementById("category").value;

        //추천 상품 화면 숨기기
        document.getElementById("recommendations").classList.add("hidden");

        //관련 하의 추천 화면 표시
        document
          .getElementById("related-recommendations")
          .classList.remove("hidden");

        displayRelatedItems(relatedProducts[category]); // 관련 하의 표시
      }

      // 하의 선택 시 이전 옵션 숨기고 option5로 이동하도록 수정
      itemDiv.onclick = () => {
        document.getElementById("related-recommendations").style.display =
          "none"; // 하의 추천 숨기기
        // 여기에 맞춤 스타일 화면으로 이동하는 코드 추가
        document.getElementById("option5").style.display = "block"; // option5 보이기
        currentOptionIndex = 4; // 현재 옵션 인덱스 업데이트
      };

      // 관련 하의 목록을 랜덤으로 표시하는 함수
      function displayRelatedItems(relatedItemList) {
        const relatedItemsDiv = document.getElementById("related-items");
        relatedItemsDiv.innerHTML = ""; // 이전 내용 초기화

        // 랜덤으로 3개의 관련 하의 선택
        const randomRelatedItems = relatedItemList
          .sort(() => 0.5 - Math.random())
          .slice(0, 3);
        randomRelatedItems.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";
          itemDiv.innerHTML = `<img src="${item.img}" alt="${item.name}" width="100"><br>${item.name}`;

          // 하의 선택 시 이전 옵션 숨기고 다음 옵션으로 이동
          itemDiv.onclick = () => {
            document.getElementById("related-recommendations").style.display =
              "none"; // 하의 추천 숨기기
            document.getElementById("option5").style.display = "block"; // option5 보이기
            currentOptionIndex = 4; // 현재 옵션 인덱스 업데이트
            //showNextOption(); // 다음 옵션으로 이동
          };

          relatedItemsDiv.appendChild(itemDiv);
        });
      }

      // 관련 하의 재추천 기능
      function relatedReRecommend() {
        const category = document.getElementById("category").value;
        displayRelatedItems(relatedProducts[category]); // 선택한 카테고리에서 관련 하의 재추천
      }

      // 추천 상품 화면으로 돌아가는 함수
      function goBackToRecommendations() {
        document
          .getElementById("related-recommendations")
          .classList.add("hidden");
        document.getElementById("recommendations").classList.remove("hidden");
      }
    </script>
  </body>
</html>
