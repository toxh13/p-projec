<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>추천 의류 세트</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding-top: 70px;
    }
    .set-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .item {
      display: flex;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      justify-content: space-between;
    }
    .item img {
      width: 150px;
      height: 200px;
      object-fit: cover;
    }
    .item-info {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      margin-left: 20px;
    }
    .button-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .action-button {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .action-button:hover {
      background-color: #0056b3;
    }
    .hidden {
      display: none;
    }
    .user-info {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #f9f9f9;
      width: 80%;
    }
  </style>
  <link href="css/styles.css" rel="stylesheet" />
  <script src="js/navbar.js" defer></script>
</head>
<body>
  <div id="nav-container"></div>
  <h1>추천 의류 세트</h1>
  <div class="set-container" id="set-container">
    <!-- 추천 의류 세트가 여기에 표시됩니다 -->
  </div>
  <div id="user-info" class="user-info hidden">
    <!-- 사용자 정보가 여기에 표시됩니다 -->
  </div>
  <div class="button-container">
    <button id="view-selection-btn" class="action-button">선택 정보 보기</button>
    <button id="save-preset-btn" class="action-button hidden">프리셋 저장하기</button>
  </div>

  <script>
    const API_BASE_URL = "http://khs.uy.to:3000"; // API 서버 주소
  
    // 임시로 상의/하의 ID를 5번과 10번으로 설정
    function getQueryParams() {
      const topClothingId = 5; // 상의 ID
      const bottomClothingId = 10; // 하의 ID
      const gender = "남성"; // 임시 성별
      const height = 175; // 임시 키
      const weight = 70; // 임시 몸무게
      const category = "캐주얼"; // 임시 스타일

      return { topClothingId, bottomClothingId, gender, height, weight, category };
    }

    // 의류 데이터와 사용자 정보를 표시
    async function displayClothingSet(ids) {
      const container = document.getElementById("set-container");
      const saveButton = document.getElementById("save-preset-btn");

      try {
        // 상의와 하의 데이터를 병렬로 가져오기
        const [topResponse, bottomResponse] = await Promise.all([
          fetch(`${API_BASE_URL}/api/clothing/${ids.topClothingId}`),
          fetch(`${API_BASE_URL}/api/clothing/${ids.bottomClothingId}`),
        ]);

        if (!topResponse.ok || !bottomResponse.ok) {
          throw new Error("의류 데이터를 가져오는 데 실패했습니다.");
        }

        const topData = await topResponse.json();
        const bottomData = await bottomResponse.json();

        // 의류 데이터 렌더링
        const topItem = `
          <div class="item">
            <img src="${topData.image_url}" alt="${topData.name}" />
            <div class="item-info">
              <h2>상의: ${topData.name}</h2>
              <p>${topData.brand ? "브랜드: " + topData.brand : "브랜드 정보 없음"}</p>
              <p>가격: ${topData.price ? topData.price + "원" : "가격 정보 없음"}</p>
            </div>
          </div>
        `;

        const bottomItem = `
          <div class="item">
            <img src="${bottomData.image_url}" alt="${bottomData.name}" />
            <div class="item-info">
              <h2>하의: ${bottomData.name}</h2>
              <p>${bottomData.brand ? "브랜드: " + bottomData.brand : "브랜드 정보 없음"}</p>
              <p>가격: ${bottomData.price ? bottomData.price + "원" : "가격 정보 없음"}</p>
            </div>
          </div>
        `;

        container.innerHTML = `
          <h2>추천 스타일: ${ids.category}</h2>
          ${topItem}
          ${bottomItem}
        `;

        // 사용자 정보 렌더링
        const userInfoContainer = document.getElementById("user-info");
        userInfoContainer.innerHTML = `
          <h3>사용자 정보</h3>
          <p><strong>성별:</strong> ${ids.gender}</p>
          <p><strong>키:</strong> ${ids.height} cm</p>
          <p><strong>몸무게:</strong> ${ids.weight} kg</p>
          <p><strong>스타일:</strong> ${ids.category}</p>
        `;

        // 프리셋 저장 버튼 활성화 및 이벤트 추가
        saveButton.classList.remove("hidden");
        saveButton.addEventListener("click", () => savePreset(ids));
      } catch (error) {
        console.error("의류 데이터를 불러오는 중 오류 발생:", error);
        alert("의류 데이터를 가져오는 데 실패했습니다.");
      }
    }

    // 선택 정보 보기 버튼 클릭 시 사용자 정보 토글
    document.getElementById("view-selection-btn").addEventListener("click", () => {
      const userInfoContainer = document.getElementById("user-info");
      userInfoContainer.classList.toggle("hidden");
    });

    // 페이지 로드 시 데이터 표시
    window.onload = () => {
      const ids = getQueryParams();
      if (ids) {
        displayClothingSet(ids);
      }
    };
  </script>
</body>
</html>
